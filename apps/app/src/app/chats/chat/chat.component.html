<div class="chat">
  <div class="messages" #chatContent>
    <div class="messages-wrapper">
      <div
        class="message-wrapper"
        [ngClass]="{
          ai: message.role === 'AI',
          human: message.role === 'HUMAN',
          system: message.role === 'SYSTEM'
        }"
        *ngFor="let message of chatService.messages"
      >
        <div
          class="message"
          [ngClass]="{
            ai: message.role === 'AI',
            human: message.role === 'HUMAN',
            system: message.role === 'SYSTEM'
          }"
        >
          <div class="header">
            <div class="from">
              <span *ngIf="message.role === 'HUMAN'">{{
                chatService.user.name
              }}</span>
              <span *ngIf="message.role === 'AI'">{{
                chatService.aiEmployee.name
              }}</span>
              <span *ngIf="message.role === 'SYSTEM'">SYSTEM</span>
            </div>

            <div class="date">
              <div
                class="material-symbols-outlined icon"
                matTooltip="{{
                  message.createdAt | date : 'dd/MM/yyyy HH:mm:ss'
                }}"
              >
                schedule
              </div>
            </div>
          </div>

          <div class="content">
            <markdown
              *ngIf="message.role === 'HUMAN' || message.role === 'AI'"
              >{{ message.content }}</markdown
            >
            <div *ngIf="message.role === 'SYSTEM'">
              <div *ngIf="message.content.action">
                <strong>Action: </strong>{{ message.content.action }}
              </div>
              <div *ngIf="message.content.thought">
                <strong>Thought: </strong>{{ message.content.thought }}
              </div>
            </div>
          </div>
        </div>

        <!-- Rating space -->
        <div class="rating-wrapper" *ngIf="message.role === 'AI'">
          <i
            class="rating-icon like fa fa-thumbs-o-up"
            aria-hidden="true"
            (click)="$event.stopPropagation(); onApprove(message._id)"
          ></i>
          <i
            class="rating-icon unlike fa fa-thumbs-o-down"
            aria-hidden="true"
            (click)="$event.stopPropagation(); onReprove(message._id)"
          ></i>
        </div>
      </div>

      <!-- No messages -->
      <div class="no-messages" *ngIf="chatService.messages.length === 0">
        No messages yet. Start a conversation by typing a message below.
      </div>

      <!-- Tokens -->
      <div class="message" *ngIf="chatService.tokens">
        <div class="from">
          <strong>{{ chatService.aiEmployee.name }}</strong>
        </div>
        <div class="content">
          <div *ngIf="chatService.thinking.action">
            <strong>Action: </strong>{{ chatService.thinking.action }}
          </div>
          <div *ngIf="chatService.thinking.thought">
            <strong>Thought: </strong>{{ chatService.thinking.thought }}
          </div>
          <div *ngIf="chatService.thinking.answer">
            <strong>Answer: </strong>{{ chatService.thinking.answer }}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Feedback Modal -->
  <div id="feedback-modal" class="modal fade" tabindex="-1">
    <div class="form">
      <form [formGroup]="formGroup" (ngSubmit)="onSuggest()">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <div class="header-description">
                <i
                  id="feedback-icon"
                  class="feedback-icon like fa"
                  aria-hidden="true"
                ></i>
                <strong class="modal-title">Provide additional feedback</strong>
              </div>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <input type="hidden" name="rating" id="rating" />
              <textarea
                type="text"
                class="suggest-style"
                placeholder="What do you like about the response?"
                formControlName="suggestions"
              ></textarea>
            </div>
            <div class="modal-footer">
              <button type="submit" class="btn btn-primary suggest-button">
                Submit feedback
              </button>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>

  <div class="text-field">
    <form class="form-wrapper" (ngSubmit)="onSubmit(f)" #f="ngForm">
      <button
        class="icon material-symbols-outlined"
        matTooltip="Send message"
        type="submit"
      >
        send
      </button>
      <input
        type="text"
        ngModel
        name="message"
        placeholder="Send a message..."
        required
        #inputMessage
      />
    </form>
  </div>
</div>
